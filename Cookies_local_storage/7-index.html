<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      let availableItems = ['Shampoo', 'Soap', 'Sponge', 'Water']
      let cart = getCartFromStorage()

      if (typeof sessionStorage === 'undefined') {
        alert(
          'Sorry, your browser does not support Web storage. Try again with a better one'
        )
      } else {
        createStore()
        displayCart()
      }

      function getCartFromStorage() {
        let cartString = sessionStorage.getItem('cart')
        if (cartString) {
          return JSON.parse(cartString)
        } else {
          return {}
        }
      }

      // add key to local storage w val of true
      // local storage only supports string values
      function addItemToCart(item) {
        if (!cart[item]) {
          cart[item] = 1
        } else {
          cart[item]++
        }
        sessionStorage.setItem('cart', JSON.stringify(cart))
        displayCart()
      }

      function removeItemFromCart(item) {
        delete cart[item]
        sessionStorage.setItem('cart', JSON.stringify(cart))
        displayCart()
      }

      function clearCart() {
        cart = {}
        sessionStorage.setItem('cart', JSON.stringify(cart))
        displayCart()
      }

      // dynamically creates an ul in document body w each li item
      // corresponding to an item in availableItems array
      function createStore() {
        let headerAvailProds = document.createElement('h2')
        headerAvailProds.textContent = 'Available products:'
        document.body.appendChild(headerAvailProds)

        let ul = document.createElement('ul') // create ul element
        document.body.append(ul) // append ul to body
        availableItems.forEach(function (item) {
          // loop through availableItems
          let li = document.createElement('li') // create li element
          li.textContent = item // text displayed for each li will be the name of item from avalableItems array
          li.addEventListener('click', function () {
            addItemToCart(item)
          })
          ul.appendChild(li) // append li to end of ul (move specified node (li) to end parent node (ul))
        })
      }

      function displayCart() {
        let headerYourCart = document.createElement('h2')
        headerYourCart.textContent = 'Your cart'
        if (!document.getElementById('cartHeader')) {
          headerYourCart.id = 'cartHeader'
          document.body.appendChild(headerYourCart)
        }

        let divCart = document.createElement('div')
        divCart.id = 'cartDiv'
        document.body.appendChild(divCart)

        updateCart()
      }

      function updateCart() {
        let divCart = document.getElementById('cartDiv')
        divCart.innerHTML = ''
        let ul = document.createElement('ul')

        let clearMyCart = document.createElement('li')
        clearMyCart.textContent = 'Clear my cart'
        clearMyCart.addEventListener('click', clearCart)
        ul.appendChild(clearMyCart)

        if (Object.keys(cart).length > 0) {
          Object.keys(cart).forEach(function (item) {
            let li = document.createElement('li')
            li.textContent = `${item} x ${cart[item]}`
            li.addEventListener('click', function () {
              removeItemFromCart(item)
            })
            ul.appendChild(li)
          })
        } else {
          let emptyCartMessage = document.createElement('li')
          emptyCartMessage.textContent = 'Your cart is empty'
          ul.appendChild(emptyCartMessage)
        }
        divCart.appendChild(ul)
      }

      createStore()
      displayCart()
    </script>
  </body>
</html>
